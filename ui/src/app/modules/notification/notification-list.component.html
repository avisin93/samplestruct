<div class="col-md-12">
  <div class="top-section row-10 mar-20 heading-section-notification">
    <div class="hidden-xs col-xs-12 col-sm-6">
      <app-heading-section heading="Notification">
          <app-breadcrumbs [breadcrumbs]="breadcrumbs"></app-breadcrumbs>
      </app-heading-section>
    </div>        
    <div class="clearfix"></div>
  </div>
  <div class="cm-card">
    <div class="cm-card-body">
      <div class="row btn-container">
        <div class="w-100 d-flex">
          <div class="notify-align-left">
            <span *ngIf="currentView == 'primary'" class="mr-5">
              <mat-form-field>
                <mat-label><i class="fa fa-cog"></i> Customize </mat-label>
                <mat-select [disableOptionCentering]="true" [formControl]="customizeMenuSelect" [multiple]="true" #multiSelect>
                  <mat-option>
                    <ngx-mat-select-search [formControl]="customizeMenuFilter" [placeholderLabel]="'Find column...'"
                         [noEntriesFoundLabel]="'No matching column found'"></ngx-mat-select-search>
                  </mat-option>
                  <mat-option *ngFor='let col of filteredColumnsMulti | async' [value]="col" (click)='toggleColumns(col)'>{{col.customizeName}}</mat-option>
                </mat-select>
              </mat-form-field>
            </span>
            <span *ngIf="currentView == 'primary'" class="mr-5">
              <mat-form-field
                style="max-width: 100px"
                [ngStyle]="{ 'width.%': currentView == '18' }"
              >
                <input
                  ngModel
                  matInput
                  (ngModelChange)="onChoosenDate($event)"
                  class="mat-input-element mat-form-field-autofill-control cdk-text-field-autofill-monitored"
                  
                  aria-invalid="false"
                  aria-required="false"
                  [(ngModel)]="inputDatePicker"
                  name="inputDatePicker"
                  [ngModelOptions]="{ standalone: true }"
                  [matDatepicker]="inputDateMatPicker"
                  (click)="inputDateMatPicker.open()"
                />
                <span
                  (click)="inputDateMatPicker.open()"
                  style="font-size: 1.4rem; padding-right: .5rem;"
                  matPrefix
                  ><i class="fa fa-calendar"></i>&nbsp;
                </span>
                
                <mat-datepicker #inputDateMatPicker></mat-datepicker>
              </mat-form-field>
            </span>
            <span class="mr-5">
              <button 
                class="cm-btn-2 primary-btn" 
                mwlCalendarToday
                [(viewDate)]="viewDate"
                (viewDateChange)="viewDateChange.next(viewDate)"
                (click)="setToday()">
                Today
              </button>
            </span>
            <span class="year-and-month">
              <button mat-icon-button 
              mwlCalendarPreviousView
              [view]="viewAlt"
              [(viewDate)]="viewDate"
              (viewDateChange)="viewDateChange.next(viewDate)"
              (click)="previousMonth()"
              class="mr-5">
                <i class="fas fa-chevron-left square-arrow wdth-2rem"></i>
              </button>
              <span
                (click)="currentMonth()"
                class="cm-notification-list-header-label">{{ periodMonthLabel }}
              </span>
              <button
                mwlCalendarNextView
                [view]="viewAlt"
                [(viewDate)]="viewDate"
                (viewDateChange)="viewDateChange.next(viewDate)"
                (click)="nextMonth()"
                class="ml-5"
                mat-icon-button>
                <i class="fas fa-chevron-right square-arrow wdth-2rem"></i>
              </button>
            </span>
  
            <span class="btn-group" *ngIf="currentView == 'secondary'">
              <span
                class="btn btn-primary"
                (click)="view = CalendarView.Day; viewAlt = 'month';"
                [class.active]="view === CalendarView.Day"
              >
                Day
              </span>
              <span
                class="btn btn-primary"
                (click)="view = CalendarView.Week; viewAlt = 'week';"
                [class.active]="view === CalendarView.Week"
              >
                Week
              </span>
              <span
                class="btn btn-primary"
                (click)="view = CalendarView.Month; viewAlt = 'month';"
                [class.active]="view === CalendarView.Month"
              >
                Month
              </span>
            </span>
          </div>
          <div class="notify-header-right ml-auto">
            <button *ngIf="show" mat-button class="reset-adv-search" (click)="resetAdvSearch()">
                RESET
            </button>
            <i *ngIf="currentView == 'primary'"
            matTooltip="List view"
            [matTooltipClass]="{'align-on-right': true}"
            class="fas fa-list-ul {{
              currentView == 'secondary' ? 'selected-noti' : ''
            }} noti-icon"
            (click)="changeView('primary')"
            >
            </i>
            <i *ngIf="currentView == 'secondary'"
            matTooltip="List view"
            class="fas fa-list-ul {{
              currentView == 'secondary' ? 'selected-noti' : ''
            }} noti-icon"
            (click)="changeView('primary')"
            >
            </i>
            <i *ngIf="currentView == 'primary'"
            matTooltip="Calendar view"
            [matTooltipClass]="{'align-on-right': true}"
            class="fas fa-th-large {{
              currentView == 'primary' ? 'selected-noti' : ''
            }} noti-icon mr-4"
            (click)="changeView('secondary')"
            >
            </i>
            <i *ngIf="currentView == 'secondary'"
            matTooltip="Calendar view"
            class="fas fa-th-large {{
              currentView == 'primary' ? 'selected-noti' : ''
            }} noti-icon mr-4"
            (click)="changeView('secondary')"
            >
            </i>
            <button id="add" class="cm-btn primary-btn primary-pink-color" (click)="navigateAddNotification()">
              Add
            </button>
          </div>
        </div>
      </div>
      <div class="row icon-container" *ngIf="currentView == 'primary'">
        <div class="action-items-icons">
          <i matTooltip="Enable/Disable notifications" [matTooltipClass]="{'align-on-right': true}" class="fas fa-bell" (click)="changeStatusNotifications(row)"></i>
          <i matTooltip="Delete notifications" [matTooltipClass]="{'align-on-right': true}" class="fas fa-trash-alt" (click)="openDialogForDeleteConfirmation(undefined)"></i>
        </div>
      </div>
      <ng-template #textHeaderTemplate let-column="column" ngx-datatable-header-template>
        <span class="header-name">{{column.name}}</span>
      </ng-template>
      <ng-template #textColumnTemplate let-row="row" let-value="value" let-rowIdentity="rowIdentity" let-rowIndex="rowIndex" ngx-datatable-cell-template>
        <span>{{value}}</span>
      </ng-template>
      <ng-template
        #actionColumnTemplate
        let-row="row"
        let-value="value"
        let-rowIndex="rowIndex"
        ngx-datatable-cell-template
      >
        <div class="action-items-i">
          <button class="action-button" (click)="changeStatusNotification(row)">
            <i style="margin-right:15px;" class="fa fa-bell{{row.send_notification ? '' : '-slash'}}"></i>       
          </button>
          <button class="action-button" (click)="editNotification(row)">
            <i style="margin-right:15px;" matTooltip="Edit" class="fas fa-pencil-alt"></i>
          </button>
          <button class="action-button" (click)="openDialogForDeleteConfirmation(row)">
            <i matTooltip="Delete" [matTooltipClass]="{'align-on-right': true}" class="fas fa-trash-alt"></i>
          </button>
        </div>
      </ng-template>
      <ng-template
        #sortableHeaderTemplateInput
        let-column="column"
        ngx-datatable-header-template
      >
        <span class="header-name">{{ column.name }}</span>
        <div class="filter-continer">
          <input
            class="filter src-filters"
            placeholder="Filter"
            (keyup)="filterCallback($event, column.searchName)"
          />
        </div>
      </ng-template>
      <ng-template
        #sortableHeaderTemplateSelectCategories
        let-column="column"
        ngx-datatable-header-template
      >
        <span class="header-name">{{ column.name }}</span>
        <div class="filter-continer">
          <select
            [(ngModel)]="selectedCategories"
            class="filter"
            placeholder="Filter"
            (change)="filterCallback($event, column.filterCode)"
          >
            <option value="-1" selected>Filter</option>
            <option
              *ngFor="let category of arrayCategories"
              [value]="category.code"
            >
              {{ category.name }}
            </option>
          </select>
        </div>
      </ng-template>
      <ng-template #sortableHeaderTemplateSelectReminderStatus let-column="column" ngx-datatable-header-template>
        <span class="header-name">{{ column.name }}</span>
        <div class="filter-continer">
          <select [(ngModel)]="selectedReminderStatus" class="filter" placeholder="Filter" (change)="filterCallback($event, column.filterCode)">
            <option value="-1" selected>Filter</option>
            <option *ngFor="let reminderStatus of arrayReminderStatuses" [value]="reminderStatus.code">
              {{ reminderStatus.name }}
            </option>
          </select>
        </div>
      </ng-template>
      <ng-template #reminderStatusColumnTemplate let-row="row" let-value="value" let-rowIdentity="rowIdentity" let-rowIndex="rowIndex" ngx-datatable-cell-template>
        <div class="action-items-i">
         <span class="badge badge-{{row.reminder.reminder_status === undefined ? '': row.reminder.reminder_status.code.toLowerCase()}}">{{row.reminder.reminder_status === undefined ? '': row.reminder.reminder_status.name}}</span>
        </div>  
      </ng-template>
      <ng-template
        #sortableHeaderTemplateEventDate
        let-sort="sortFn"
        let-column="column"
        let-sortDir="sortDir"
        ngx-datatable-header-template
      >
        <span class="header-name">
          {{ column.name }}
        </span>
        <div class="filter-continer">
          <input
            class="filter"
            [ngModel]="eventDate"
            [matDatepicker]="eventDatePicker"
            (click)="eventDatePicker.open()"
            placeholder="Filter"
            (dateChange)="filterDate($event, column.searchName)"
          />
        </div>
        <mat-datepicker (opened)="resetEventDatePicker()" #eventDatePicker></mat-datepicker>
      </ng-template>
      <ng-template
        #sortableHeaderTemplateReminderStartDate
        let-sort="sortFn"
        let-column="column"
        let-sortDir="sortDir"
        ngx-datatable-header-template
      >
        <span class="header-name">
          {{ column.name }}
        </span>
        <div class="filter-continer">
          <input
            class="filter"
            [ngModel]="reminderStartDate"
            [matDatepicker]="reminderStartDatePicker"
            (click)="reminderStartDatePicker.open()"
            placeholder="Filter"
            (dateChange)="filterDate($event, column.searchName)"
          />
        </div>
        <mat-datepicker (opened)="resetReminderStartDatePicker()" #reminderStartDatePicker></mat-datepicker>
      </ng-template>
      <ng-template
        #sortableHeaderTemplateReminderEndDate
        let-sort="sortFn"
        let-column="column"
        let-sortDir="sortDir"
        ngx-datatable-header-template
      >
        <span class="header-name">
          {{ column.name }}
        </span>
        <div class="filter-continer">
          <input
            class="filter"
            [ngModel]="reminderEndDate"
            [matDatepicker]="reminderEndDatePicker"
            (click)="reminderEndDatePicker.open()"
            placeholder="Filter"
            (dateChange)="filterDate($event, column.searchName)"
          />
        </div>
        <mat-datepicker (opened)="resetReminderEndDatePicker()" #reminderEndDatePicker></mat-datepicker>
      </ng-template>
      <ng-template
        #dateColumnTemplate
        let-row="row"
        let-value="value"
        ngx-datatable-cell-template
      >
        <div>{{ value | date: 'MM/dd/yyyy' }}</div>
      </ng-template>
      <ng-template #chkBxTmplCell let-row="row">
        <mat-checkbox [checked]="row.checked" type="checkbox" (change)="onSelectCell($event, row)">
        </mat-checkbox>
      </ng-template>
      <ng-template #chkBxTmpl let-row="row">
        <mat-checkbox [checked]="headerCheckBox" type="checkbox" (change)="onSelect($event)">
        </mat-checkbox>
      </ng-template>
      <div class="row row-datatable" *ngIf="currentView == 'primary'">
        <ngx-datatable
          #datatable
          class="material striped expandable"
          [rows]="rowsTable"
          [columns]="columnsTable"
          [footerHeight]="50"
          [messages]="myMessages"
          [headerHeight]="70"
          [rowHeight]="35"
          [selectionType]="'checkbox'"
          [loadingIndicator]="isLoadingDataTable"
          [externalPaging]="true"
          [externalSorting]="true"
          [count]="pageTable.count"
          [offset]="pageTable.offset"
          [limit]="pageTable.limit"
          [sortType]="'single'"
          [columnMode]="'force'"
         
          (page)='pageCallback($event)'
          (sort)='sortCallback($event)'>
          
          <ngx-datatable-footer>
            <ng-template
              ngx-datatable-footer-template
              let-rowCount="rowCount"
              let-pageSize="pageTable.limit"
              let-curPage="curPage"
              let-offset="pageTable.offset"
              let-isVisible="isVisible">
              <div class="page-count" [hidden]="!((rowCount / pageTable.limit) > 1)">
                {{datatable.messages.totalMessage}}{{pageTable.offset * pageTable.limit + 1}} -
                {{pageTable.offset * pageTable.limit + pageTable.limit > rowCount ? rowCount : pageTable.offset * pageTable.limit + pageTable.limit }}
                of {{rowCount.toLocaleString()}}
              </div>
              <div [hidden]="!((rowCount / pageTable.limit) > 1)">
                <input style="width:40px" placeholder='Page' (change)="onInputPageChange($event.target.value)">
              </div>
              <datatable-pager
                [pagerLeftArrowIcon]="'datatable-icon-left'"
                [pagerRightArrowIcon]="'datatable-icon-right'"
                [pagerPreviousIcon]="'datatable-icon-prev'"
                [pagerNextIcon]="'datatable-icon-skip'"
                [page]="curPage"
                [size]="pageTable.limit"
                [count]="rowCount"
                [hidden]="!((rowCount / pageTable.limit) > 1)"
                (change)="datatable.onFooterPage($event)">
              </datatable-pager>
            </ng-template>
          </ngx-datatable-footer>
        </ngx-datatable>
      </div>
      <div class="row" *ngIf="currentView === 'secondary'" [ngSwitch]="view">

        <ng-template #customCellTemplate let-day="day" let-locale="locale">
          <div class="cal-cell-top" [style.background]="compareDates(day.date, inputDatePicker)? 'lightyellow' : ''">
            <span class="cal-day-number">
              <span class="cal-day-number-span">
                {{day.date | calendarDate: 'monthViewDayNumber':locale}}
              </span>
              <div class="row" *ngIf="day.events.length > 1">
                <div class="mat-calendar-body-cell-dots" *ngFor="let d of convertToArray(this.dayClasses[day.date | calendarDate: 'monthViewDayNumber':locale],' ');let i = index;">
                  <span *ngIf="d !== ''" class="{{d}}">
                    <i *ngIf="3 > i - 1 && i>0" class="fas fa-circle"></i>
                    <i *ngIf="i - 1 === 3 && i>0" class="fas fa-plus"></i>
                  </span>
                </div>
              </div>
            </span>
          </div>
          <div class="cal-cell-bottom" *ngIf="1 > day.events.length"
            [style.background]="compareDates(day.date, inputDatePicker)? 'lightyellow' : ''">

          </div>
          <div class="cal-cell-bottom" *ngIf="day.events.length > 0">
            <div class="row" [ngStyle]="applyStyles(day.events.length, 0)">
              <div class="notification-tab-icon">
                <i class="fas fa-user fa-2x notification-tab-icon-i  {{convertToArray(this.dayClasses[day.date | calendarDate: 'monthViewDayNumber':locale],' ')!== undefined ? 
                convertToArray(this.dayClasses[day.date | calendarDate: 'monthViewDayNumber':locale],' ')[0] : ''}}"></i>
              </div>
              <div class="notification-tab-info" (click)="changeViewAndRedirect(day.date)">
                <p id="event-title"><b>{{day.events[0].title}}</b></p>
                <p id="event-contract-name">{{ day.events[0].contract_name }}</p>
              </div>
            </div>
          </div>
        </ng-template>
        <!--       WEEEK TEMPLATE     -->
        <ng-template #weekHeaderTemplate let-days="days" let-locale="locale">
          <div class="cal-day-headers">
            <div class="cal-header" *ngFor="let day of days">
              <div class="row">
                <div class="col-md-4 day-in-month">
                  <b>{{formatDate(day.date,'DD')}}</b>
                </div>
                <div class="col-md-8 week-month-year">
                  <div class="col-md-12">
                    {{formatDate(day.date,'dddd')}}
                  </div>
                  <div id="month-year" class="col-md-12">
                    {{formatDate(day.date,'MMMM YYYY')}}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </ng-template>

        <ng-template #weekCellTemplate let-weekEvent="weekEvent" let-day="day" let-locale="locale" class="cal-hour">
          <div class="cal-cell-bottom">
            <div class="row">
              <div class="notification-tab-icon">
                <i class="fas fa-user fa-2x notification-tab-icon-i {{weekEvent.event.color}}"></i>
              </div>
              <div class="notification-tab-info" (click)="changeViewAndRedirect(weekEvent.event.start)">
                <p id="event-title"><b>{{weekEvent.event.title}}</b></p>
                <p id="event-contract-name">{{ weekEvent.event.contract_name }}</p>
              </div>
            </div>
          </div>
        </ng-template>
        <!--       WEEEK TEMPLATE ENDS  -->
        <!--       DAY TEMPLATE  -->
        <ng-template #dayCellTemplate let-day="day" let-locale="locale">
          <div class="cal-cell-top" [style.background]="compareDates(day.date, inputDatePicker)? 'lightyellow' : ''">
            <span class="cal-day-number">
              <div class="row">
                <div class="col-md-3" [ngClass]="(formatDate(day.date,'D')>9)?'day-in-month':'day-in-month-single-digit'">
                  <b>{{formatDate(day.date,'D')}}</b>
                </div>
                <div class="col-md-9 day-view-month-year">
                  {{formatDate(day.date,'MMMM YYYY')}}
                </div>
              </div>
            </span>
          </div>
          <div class="cal-cell-bottom" *ngIf="1 > day.events.length"
            [style.background]="compareDates(day.date, inputDatePicker)? 'lightyellow' : ''">
          </div>
          <div class="row cal-cell-bottom cal-cell-bottom-day" *ngIf="day.events.length > 0">
            <div class="event-information-wrapper" *ngFor="let event of day.events;index as i" [ngStyle]="applyStyles(day.events.length, i)">
              <div class="row">
                <div class="notification-tab-icon">
                  <i class="fas fa-user fa-2x notification-tab-icon-i  {{convertToArray(this.dayClasses[day.date | calendarDate: 'monthViewDayNumber':locale],' ')!== undefined ? 
                  convertToArray(this.dayClasses[day.date | calendarDate: 'monthViewDayNumber':locale],' ')[i] : ''}}"></i>
                </div>
                <div class="notification-tab-info" (click)="changeViewAndRedirect(day.date)">
                  <p id="event-title"><b>{{event.title}}</b></p>
                  <p id="event-contract-name">{{ event.contract_name }}</p>
                </div>
              </div>
            </div>
          </div>
        </ng-template>

        <!--       DAY TEMPLATE ENDS  -->

        <mwl-calendar-month-view
          class="row-calendar"
          *ngSwitchCase="CalendarView.Month"
          [viewDate]="viewDate"
          (eventClicked)="handleEvent('Clicked', $event.event)"
          [cellTemplate]="customCellTemplate"
          [events]="events"
          [refresh]="refresh"
        >
        </mwl-calendar-month-view>
        <mwl-calendar-week-view
          class="row-calendar"
          *ngSwitchCase="CalendarView.Week"
          [weekStartsOn]="7"
          [viewDate]="viewDate"
          (eventClicked)="handleEvent('Clicked', $event.event)"
          [events]="events"
          [refresh]="refresh"
          [eventTemplate]="weekCellTemplate"
          [headerTemplate]="weekHeaderTemplate"
          [cellTemplate]="wCellTemplate"
          [dayStartHour]="0"
          [dayEndHour]="0"
          [hourSegments]="1"
        >
        </mwl-calendar-week-view>
        <mwl-calendar-month-view
          class="row-calendar vertical-view"
          *ngSwitchCase="CalendarView.Day"
          [viewDate]="viewDate"
          (eventClicked)="handleEvent('Clicked', $event.event)"
          [events]="events"
          [cellTemplate]="dayCellTemplate"
          [refresh]="refresh"
          [startOfMonth]="1"
          [endOfMonth]="31"
        >
        </mwl-calendar-month-view>
        <mwl-calendar-year-view
          class="row-calendar"
          *ngSwitchCase="CalendarView.Year"
          [viewDate]="viewDate"
          (eventClicked)="handleEvent('Clicked', $event.event)"
          [refresh]="refresh"
        >
        </mwl-calendar-year-view>
      </div>
    </div>
  </div>
</div>
