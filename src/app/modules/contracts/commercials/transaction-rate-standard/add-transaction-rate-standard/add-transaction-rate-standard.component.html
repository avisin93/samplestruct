<div class="col-md-12 add-table" [formGroup]="formGroup">
  <div class="col-md-12 spacing-element">
    <div class="row">
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <input matInput placeholder="Line Item" formControlName="inputLineItem" />
        </mat-form-field>
      </div>
      <div class="col-md-6">
        <mat-form-field class="col-md-12 mat-form-field-has-prefix">
          <div>
            <input matInput
              class="mat-input-element mat-form-field-autofill-control cdk-text-field-autofill-monitored required"
              placeholder="Rate" required='false' aria-invalid="false" aria-required="false" formControlName="rate"
              name="rate" />
          </div>
          <span class="select-prefix"
            [ngClass]="{ 'no-display-arrow': formGroup.get('currencyType').value && formGroup.get('currencyType').value !== '' }"
            style="font-size: 1.6rem" matPrefix>
            <mat-select disableOptionCentering panelClass="select-dropdown-class" #currencyDropDown
              formControlName="currencyType" (selectionChange)="selectedCurrency()" panelClass="dropdown-currency">
              <mat-option *ngFor="let cur of arrayCurrencies" [value]="cur.code" required='false' name="currencyType"
                ngDefaultControl>
                {{ cur.symbol }}
              </mat-option>
            </mat-select>
            &nbsp;
          </span>
          <mat-error *ngIf="formGroup.get('currencyType').invalid || formGroup.get('rate').invalid">
            {{getErrorMessage(formGroup.get('currencyType').invalid ? formGroup.get('currencyType') :
                              formGroup.get('rate'))}}
          </mat-error>
        </mat-form-field>
      </div>
    </div>
  </div>
  <div class="col-md-12 spacing-element">
    <div class="row">
      <div class="col-md-6 fields-with-plus">
        <div class="col-md-11">
          <mat-form-field class="col-md-12">
            <mat-select formControlName="uom" placeholder="UOM" #singleSelect>
              <mat-option>
                <ngx-mat-select-search [formControl]="uomFilterCtrl" [placeholderLabel]="'Find UOM'"
                  [noEntriesFoundLabel]="'No matching UOM found'"></ngx-mat-select-search>
              </mat-option>
              <mat-option *ngFor='let uom of filteredUoms | async' [value]="uom.code">{{uom.name}}</mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-md-1 new-plus">
          <i class="fas fa-plus-circle fa-lg" (click)="openCreateNewObjectDialog('UOM','UOM')"></i>
        </div>
      </div>
      <div class="col-md-3">
        <mat-form-field class="col-md-12 mat-form-field-has-prefix">
          <input matInput readonly
            class="mat-input-element mat-form-field-autofill-control cdk-text-field-autofill-monitored"
            placeholder="Effective Start Date" aria-invalid="false" aria-required="false"
            formControlName="effectiveStartDate" name="effectiveStartDate" [matDatepicker]="effectiveStartDatePicker"
            (click)="effectiveStartDatePicker.open()" (dateChange)="dateFromChanged($event)" [max]="maxDateFrom" />
          <mat-datepicker-toggle matPrefix [for]="effectiveStartDatePicker">
            <mat-icon matDatepickerToggleIcon class="fa fa-calendar">
            </mat-icon>
          </mat-datepicker-toggle>
          <mat-datepicker #effectiveStartDatePicker></mat-datepicker>
        </mat-form-field>
      </div>
      <div class="col-md-3">
        <mat-form-field class="col-md-12 mat-form-field-has-prefix">
          <input matInput readonly
            class="mat-input-element mat-form-field-autofill-control cdk-text-field-autofill-monitored"
            placeholder="Effective End Date" aria-invalid="false" aria-required="false"
            formControlName="effectiveEndDate" name="effectiveEndDate" [matDatepicker]="effectiveEndDatePicker"
            (click)="effectiveEndDatePicker.open()" (dateChange)="dateToChanged($event)" [min]="minDateTo" />
          <mat-datepicker-toggle matPrefix [for]="effectiveEndDatePicker">
            <mat-icon matDatepickerToggleIcon class="fa fa-calendar">
            </mat-icon>
          </mat-datepicker-toggle>
          <mat-datepicker #effectiveEndDatePicker></mat-datepicker>
        </mat-form-field>
      </div>
    </div>
  </div>
  <div class="col-md-12 spacing-element">
    <div class="row">
      <div class="col-md-6">
        <label class="optional">Consider for Minimum Billing?</label>
        <div class="row">
          <div class="col-md-6 smallerRadioButton">
            <mat-radio-group formControlName="radioConsiderForMinBilling" ngDefaultControl>
              <mat-radio-button value="true" (click)="showAdditionalFields()">Yes</mat-radio-button>
              <mat-radio-button value="false" (click)="hideAdditionalFields()">No</mat-radio-button>
            </mat-radio-group>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-12 spacing-element" *ngIf="additionalFields">
    <div class="row">
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <mat-select disableOptionCentering panelClass="select-dropdown-class" placeholder="Type"
            formControlName="selectedBillingType">
            <mat-option *ngFor="let billingType of arrayBillingType" [value]="billingType.code">
              {{ billingType.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <input matInput
            placeholder="{{formGroup.get('selectedBillingType').value === 'VALUE'? 'Amount' : 'Quantity'}}"
            formControlName="billingValue" />
          <mat-error *ngIf="formGroup.get('billingValue').invalid">
            {{getErrorMessage(formGroup.get('billingValue'))}}
          </mat-error>
        </mat-form-field>
      </div>
    </div>
  </div>
  <div class="col-md-12 spacing-element">
    <div class="row">
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <input matInput placeholder="Reference No." formControlName="inputReferenceNo" />
        </mat-form-field>
      </div>
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <input matInput placeholder="Related Reference No." formControlName="inputRelatedRefNo" />
          <mat-error *ngIf="formGroup.get('inputRelatedRefNo').invalid">
            {{ getErrorMessage(formGroup.get('inputRelatedRefNo')) }}
          </mat-error>
        </mat-form-field>
      </div>
    </div>
  </div>
  <div class="col-md-12 spacing-element">
    <div class="row">
      <div class="col-md-6 fields-with-plus">
        <div class="col-md-11">
          <mat-form-field class="col-md-12">
            <mat-select placeholder="Linked Opportunity" formControlName="selectedLinkedOpportunity" #singleSelect>
              <mat-option>
                <ngx-mat-select-search [formControl]="linkedOpportunityFilter"
                  [placeholderLabel]="'Find Linked Opportunity'"
                  [noEntriesFoundLabel]="'No matching Linked Opportunity found'">
                </ngx-mat-select-search>
              </mat-option>
              <mat-option *ngFor="let linkedOpportunity of filteredLinkedOpportunities | async"
                [value]="linkedOpportunity.code">
                {{ linkedOpportunity.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-md-1 new-plus">
          <i class="fas fa-plus-circle fa-lg"
            (click)="openCreateNewObjectDialog('Linked Opportunity','LINKED_OPPORTUNITY')"></i>
        </div>
      </div>
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <mat-select disableOptionCentering panelClass="select-dropdown-class" placeholder="Related Doc"
            formControlName="selectedRelatedDoc">
            <mat-option *ngFor="let relatedDoc of arrayRelatedDoc" [value]="relatedDoc.code">
              {{ relatedDoc.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
    </div>
  </div>
  <div class="col-md-12 spacing-element">
    <div class="col-md-12">
      <div class="col-md-12">
        <h5><b>REPORTING FIELDS</b></h5>
      </div>
    </div>
  </div>
  <div class="col-md-12 spacing-element">
    <div class="row">
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <input matInput placeholder="Platforms Applicable" formControlName="inputPlatformsApplicable" />
        </mat-form-field>
      </div>
      <div class="col-md-6 fields-with-plus">
        <div class="col-md-11">
          <mat-form-field class="col-md-12">
            <mat-select placeholder="Service" formControlName="selectedService">
              <mat-option>
                <ngx-mat-select-search [formControl]="serviceFilter" [placeholderLabel]="'Find Service'"
                  [noEntriesFoundLabel]="'No matching Service found'">
                </ngx-mat-select-search>
              </mat-option>
              <mat-option *ngFor="let service of filteredService | async" [value]="service.code">
                {{ service.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-md-1 new-plus">
          <i class="fas fa-plus-circle fa-lg" (click)="openCreateNewObjectDialog('Service','SERVICE')"></i>
        </div>
      </div>
    </div>
  </div>

  <div class="col-md-12 spacing-element">
    <div class="row">
      <div class="col-md-6 fields-with-plus">
        <div class="col-md-11">
          <mat-form-field class="col-md-12">
            <mat-select placeholder="Sub Service" formControlName="selectedSubService">
              <mat-option>
                <ngx-mat-select-search [formControl]="subserviceFilter" [placeholderLabel]="'Find Sub Service'"
                  [noEntriesFoundLabel]="'No matching Sub Service found'">
                </ngx-mat-select-search>
              </mat-option>
              <mat-option *ngFor="let subservice of filteredSubService | async" [value]="subservice.code">
                {{ subservice.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-md-1 new-plus">
          <i class="fas fa-plus-circle fa-lg" (click)="openCreateNewObjectDialog('Sub Service','SUB_SERVICE')"></i>
        </div>
      </div>
      <div class="col-md-6 fields-with-plus">
        <div class="col-md-11">
          <mat-form-field class="col-md-12">
            <mat-select placeholder="Project" formControlName="selectedProject">
              <mat-option>
                <ngx-mat-select-search [formControl]="projectFilter" [placeholderLabel]="'Find Project'"
                  [noEntriesFoundLabel]="'No matching Project found'">
                </ngx-mat-select-search>
              </mat-option>
              <mat-option *ngFor="let project of filteredProject | async" [value]="project.code">
                {{ project.name }}
              </mat-option>
            </mat-select>
          </mat-form-field>
        </div>
        <div class="col-md-1 new-plus">
          <i class="fas fa-plus-circle fa-lg" (click)="openCreateNewObjectDialog('Project','PROJECT')"></i>
        </div>
      </div>
    </div>
  </div>
  <div class="col-md-12 spacing-element">
    <div class="row">
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <mat-select disableOptionCentering panelClass="select-dropdown-class" placeholder="Sub Project"
            formControlName="selectedSubProject">
            <mat-option *ngFor="let subProject of arraySubProject" [value]="subProject.code">
              {{ subProject.name }}
            </mat-option>
          </mat-select>
        </mat-form-field>
      </div>
      <div class="col-md-6">
        <mat-form-field class="col-md-12">
          <input (keyup)="onManualChangeInputLocation($event)" matInput type="text"
            class="google-place-input mat-input-element mat-form-field-autofill-control cdk-text-field-autofill-monitored"
            #location formControlName="location" name="location" google-place placeholder="Location" />
          <i class="fas fa-search" matSuffix></i>
          <mat-error *ngIf="formGroup.get('location').invalid">
            {{getErrorMessage(formGroup.get('location'))}}
          </mat-error>
        </mat-form-field>
      </div>
    </div>
  </div>

  <cm-additional-reporting-fields formGroupName="additionalFormGroup" [numOfFieldsInRow]="2"
    [(additionalReportingFields)]="additionalReportingFields"
    [(additionalReportingFieldsArray)]="additionalReportingFieldsArray" [cdr]="cd"></cm-additional-reporting-fields>
  <div class="content-right btn-container ds-vw">
    <button color="primary" class="cm-btn" id="cancel" (click)="cancel()">
      Cancel
    </button>
    <button color="primary" class="cm-btn primary-pink-color" (click)="saveTransactionRateStandard()">
      SAVE AND CONTINUE
    </button>
  </div>
  <div class="content-right btn-mob-container">
    <button color="primary" class="cm-mob-btn mb-vw" id="cancel" (click)="cancel()">
      Cancel
    </button>
    <button color="primary" class="cm-mob-btn mb-vw primary-pink-color" (click)="saveTransactionRateStandard()">
      SAVE AND CONTINUE
    </button>
  </div>
</div>